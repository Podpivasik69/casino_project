# Requirements Document: Slots Game

## Introduction

This document specifies the requirements for a slot machine game feature with two modes for the Django casino platform: a classic 3-reel mode for quick gameplay and an extended 5-reel mode with more winning combinations. The Slots game follows the established patterns of existing games (Mines, Plinko, Dice) and integrates with the platform's wallet system and Provably Fair random number generation service. Players can place bets, choose their preferred reel count, spin the reels to match symbols, and win based on predefined multipliers for various symbol combinations. The game features advanced vertical scrolling animations with smooth transitions and visual effects.

## Glossary

- **Slots_Game**: The slot machine game system that manages game creation, reel spinning, win detection, and payout calculation
- **Reel**: A vertical column displaying one symbol; the game has either 3 or 5 reels depending on mode
- **Reel_Mode**: The game mode determining the number of reels (3 for classic, 5 for extended)
- **Symbol**: A visual icon displayed on a reel (cherry, lemon, orange, star, bell, seven)
- **Spin**: A single game round where all reels generate random symbols with vertical scrolling animation
- **Win_Combination**: A pattern of matching symbols across the reels that results in a payout
- **Winning_Line**: For 5-reel mode, a specific pattern across reels that can result in a win (e.g., horizontal lines, diagonals)
- **Multiplier**: A numeric value that multiplies the bet amount to calculate winnings
- **Consecutive**: Symbols appearing in adjacent positions starting from the leftmost reel
- **Auto_Spin**: A feature that automatically repeats spins until stopped by the user or insufficient balance
- **Vertical_Scroll_Animation**: The visual effect where symbols scroll from top to bottom before stopping
- **Bounce_Effect**: The animation where reels slightly overshoot and bounce back when stopping
- **Glow_Effect**: Visual highlighting of winning combinations with glowing borders
- **Wallet_Service**: The existing service that manages user balance and transactions
- **Provably_Fair_Service**: The existing service that generates verifiable random numbers
- **Server_Seed**: A random value generated by the server for Provably Fair verification
- **Client_Seed**: A random value provided by the client for Provably Fair verification
- **Nonce**: A sequential counter used in Provably Fair calculations

## Requirements

### Requirement 1: Game Creation and Mode Selection

**User Story:** As a player, I want to choose between 3-reel and 5-reel modes and place a bet, so that I can play the game style I prefer and potentially win based on symbol combinations.

#### Acceptance Criteria

1. WHEN a player initiates a spin with a valid bet amount and reel count, THE Slots_Game SHALL create a new game record with the bet amount, reel count (3 or 5), user reference, and Provably Fair seeds
2. WHEN a player initiates a spin, THE Slots_Game SHALL verify the player's balance is sufficient for the bet amount
3. IF the player's balance is insufficient, THEN THE Slots_Game SHALL reject the spin request and return an error message
4. WHEN a game is created, THE Slots_Game SHALL deduct the bet amount from the player's balance immediately
5. WHEN a bet amount is provided, THE Slots_Game SHALL validate it is a positive decimal value
6. WHEN a reel count is provided, THE Slots_Game SHALL validate it is either 3 or 5
7. IF no reel count is specified, THE Slots_Game SHALL default to 5 reels
8. WHEN a 3-reel game is created, THE Slots_Game SHALL use the 3-reel payout table
9. WHEN a 5-reel game is created, THE Slots_Game SHALL use the 5-reel payout table

### Requirement 2: Reel Generation and Symbol Selection

**User Story:** As a player, I want the slot machine to generate random symbols on 3 or 5 reels based on my chosen mode, so that each spin is fair and unpredictable.

#### Acceptance Criteria

1. WHEN a spin occurs in 3-reel mode, THE Slots_Game SHALL generate exactly 3 symbols using the Provably_Fair_Service
2. WHEN a spin occurs in 5-reel mode, THE Slots_Game SHALL generate exactly 5 symbols using the Provably_Fair_Service
3. WHEN generating symbols, THE Slots_Game SHALL select from the valid symbol set: üçí, üçã, üçä, ‚≠ê, üîî, 7Ô∏è‚É£
4. WHEN generating symbols, THE Slots_Game SHALL use the Server_Seed, Client_Seed, and Nonce to ensure verifiable randomness
5. WHEN symbols are generated, THE Slots_Game SHALL store the complete reel results in the game record
6. WHEN a spin completes, THE Slots_Game SHALL increment the Nonce for the next game
7. WHEN storing reel results, THE Slots_Game SHALL also store the reel count used for the game

### Requirement 3: Win Detection and Combination Matching

**User Story:** As a player, I want the game to automatically detect winning combinations based on my chosen mode, so that I know if I've won and what combination I achieved.

#### Acceptance Criteria - 3-Reel Mode

1. WHEN all 3 reels show identical 7Ô∏è‚É£ symbols, THE Slots_Game SHALL recognize a 50x multiplier win
2. WHEN all 3 reels show identical ‚≠ê symbols, THE Slots_Game SHALL recognize a 25x multiplier win
3. WHEN all 3 reels show identical üîî symbols, THE Slots_Game SHALL recognize a 15x multiplier win
4. WHEN all 3 reels show identical üçä symbols, THE Slots_Game SHALL recognize a 10x multiplier win
5. WHEN all 3 reels show identical üçã symbols, THE Slots_Game SHALL recognize a 7x multiplier win
6. WHEN all 3 reels show identical üçí symbols, THE Slots_Game SHALL recognize a 5x multiplier win

#### Acceptance Criteria - 5-Reel Mode

7. WHEN all 5 reels show identical 7Ô∏è‚É£ symbols, THE Slots_Game SHALL recognize a 100x multiplier win
8. WHEN all 5 reels show identical ‚≠ê symbols, THE Slots_Game SHALL recognize a 50x multiplier win
9. WHEN all 5 reels show identical üîî symbols, THE Slots_Game SHALL recognize a 25x multiplier win
10. WHEN all 5 reels show identical üçä symbols, THE Slots_Game SHALL recognize a 15x multiplier win
11. WHEN all 5 reels show identical üçã symbols, THE Slots_Game SHALL recognize a 10x multiplier win
12. WHEN all 5 reels show identical üçí symbols, THE Slots_Game SHALL recognize a 5x multiplier win
13. WHEN the first 3 consecutive reels show identical 7Ô∏è‚É£ symbols, THE Slots_Game SHALL recognize a 20x multiplier win
14. WHEN the first 3 consecutive reels show identical ‚≠ê symbols, THE Slots_Game SHALL recognize a 10x multiplier win
15. WHEN the first 3 consecutive reels show identical üîî symbols, THE Slots_Game SHALL recognize a 5x multiplier win

#### Acceptance Criteria - General

16. WHEN no winning combination is detected, THE Slots_Game SHALL set the multiplier to 0
17. WHEN multiple winning combinations are present, THE Slots_Game SHALL select the combination with the highest multiplier
18. WHEN checking wins in 5-reel mode, THE Slots_Game SHALL prioritize 5-of-a-kind over 3-consecutive matches

### Requirement 4: Payout Calculation and Balance Update

**User Story:** As a player, I want to receive my winnings automatically when I achieve a winning combination, so that my balance reflects my game results.

#### Acceptance Criteria

1. WHEN a winning combination is detected, THE Slots_Game SHALL calculate the win amount by multiplying the bet amount by the multiplier
2. WHEN a win amount is calculated, THE Slots_Game SHALL add the win amount to the player's balance using the Wallet_Service
3. WHEN a spin results in no win, THE Slots_Game SHALL set the win amount to 0 and make no balance adjustment
4. WHEN a payout is processed, THE Slots_Game SHALL store the win amount in the game record
5. WHEN a payout is processed, THE Slots_Game SHALL store the winning combination description in the game record

### Requirement 5: Auto-Spin Functionality

**User Story:** As a player, I want to enable auto-spin mode to continuously play without manual interaction, so that I can play multiple rounds efficiently.

#### Acceptance Criteria

1. WHEN a player enables auto-spin, THE Slots_Game SHALL continuously create new spins using the same bet amount
2. WHEN auto-spin is active and the player's balance becomes insufficient, THE Slots_Game SHALL stop auto-spinning and notify the player
3. WHEN a player disables auto-spin, THE Slots_Game SHALL stop creating new spins after the current spin completes
4. WHEN auto-spin creates a new game, THE Slots_Game SHALL follow all standard game creation, validation, and payout rules

### Requirement 6: Game History and Retrieval

**User Story:** As a player, I want to view my past slot game results, so that I can track my gameplay history and verify outcomes.

#### Acceptance Criteria

1. WHEN a player requests their game history, THE Slots_Game SHALL return all games associated with that player
2. WHEN returning game history, THE Slots_Game SHALL include game ID, bet amount, reel results, multiplier, win amount, winning combination, and timestamp
3. WHEN a player requests a specific game by ID, THE Slots_Game SHALL return the complete game details if the game belongs to that player
4. IF a player requests a game that does not belong to them, THEN THE Slots_Game SHALL reject the request with an authorization error

### Requirement 7: API Integration and Response Format

**User Story:** As a frontend developer, I want consistent API endpoints and response formats, so that I can integrate the slots game with the user interface.

#### Acceptance Criteria

1. WHEN a spin is requested via API, THE Slots_Game SHALL accept a JSON payload containing the bet amount
2. WHEN a spin completes successfully, THE Slots_Game SHALL return a JSON response containing game ID, reel results, multiplier, win amount, winning combination, and updated balance
3. WHEN an error occurs, THE Slots_Game SHALL return a JSON response with an error message and appropriate HTTP status code
4. WHEN game history is requested, THE Slots_Game SHALL return a JSON array of game objects ordered by creation timestamp descending
5. THE Slots_Game SHALL require authentication for all API endpoints

### Requirement 8: Frontend Display and User Interaction

**User Story:** As a player, I want an intuitive and visually stunning slot machine interface with smooth animations, so that I can enjoy playing the game and easily understand the results.

#### Acceptance Criteria - Layout and Mode Selection

1. WHEN the slots page loads, THE Slots_Game SHALL display mode selection buttons for 3-reel and 5-reel options
2. WHEN a player selects 3-reel mode, THE Slots_Game SHALL display 3 reel positions with placeholder symbols
3. WHEN a player selects 5-reel mode, THE Slots_Game SHALL display 5 reel positions with placeholder symbols
4. THE Slots_Game SHALL display bet amount selection buttons for quick betting
5. THE Slots_Game SHALL display an auto-spin toggle button with clear on/off states

#### Acceptance Criteria - Vertical Scrolling Animation

6. WHEN a player clicks the spin button, THE Slots_Game SHALL display a vertical scrolling animation on all reels
7. WHEN reels are spinning, THE Slots_Game SHALL show symbols scrolling from top to bottom continuously
8. WHEN spin results are received, THE Slots_Game SHALL stop each reel sequentially with a stagger effect (left to right)
9. WHEN a reel stops, THE Slots_Game SHALL display a bounce effect where the reel slightly overshoots and bounces back
10. WHEN reels are spinning, THE Slots_Game SHALL use random spin speeds for each reel to create visual variety
11. WHEN the final symbol is revealed, THE Slots_Game SHALL use a smooth deceleration animation

#### Acceptance Criteria - Visual Effects

12. WHEN a win occurs, THE Slots_Game SHALL highlight the winning symbols with a glowing border effect
13. WHEN a jackpot occurs (highest multiplier), THE Slots_Game SHALL display an explosion/burst animation
14. WHEN winning symbols are highlighted, THE Slots_Game SHALL animate the glow effect with pulsing
15. WHEN the player's balance updates, THE Slots_Game SHALL display the new balance with a smooth transition
16. WHEN a win amount is displayed, THE Slots_Game SHALL animate the number counting up from 0

#### Acceptance Criteria - User Feedback

17. WHEN auto-spin is active, THE Slots_Game SHALL disable manual spin button and show auto-spin status
18. WHEN a spin is in progress, THE Slots_Game SHALL disable the spin button to prevent double-spinning
19. WHEN an error occurs, THE Slots_Game SHALL display a clear error message with appropriate styling
20. THE Slots_Game SHALL display the current mode (3-reel or 5-reel) prominently during gameplay

### Requirement 9: Data Persistence and Model Structure

**User Story:** As a system administrator, I want all game data properly stored in the database, so that we can maintain records for auditing and dispute resolution.

#### Acceptance Criteria

1. WHEN a game is created, THE Slots_Game SHALL persist a record with user reference, bet amount, reel count, reel results, multiplier, win amount, winning combination, Server_Seed, Client_Seed, Nonce, and timestamp
2. WHEN storing reel results, THE Slots_Game SHALL use a JSON field to store the array of 3 or 5 symbols
3. WHEN storing the reel count, THE Slots_Game SHALL use an integer field with values 3 or 5
4. WHEN storing monetary values, THE Slots_Game SHALL use decimal fields with appropriate precision
5. THE Slots_Game SHALL enforce a foreign key relationship between game records and user records
6. THE Slots_Game SHALL automatically set the creation timestamp when a game record is created

### Requirement 10: Provably Fair Integration

**User Story:** As a player, I want to verify that game outcomes are fair and not manipulated, so that I can trust the platform.

#### Acceptance Criteria

1. WHEN a game is created, THE Slots_Game SHALL generate a Server_Seed using the Provably_Fair_Service
2. WHEN generating reel symbols, THE Slots_Game SHALL use the Provably_Fair_Service with Server_Seed, Client_Seed, and Nonce
3. WHEN a player requests game details, THE Slots_Game SHALL include the Server_Seed, Client_Seed, and Nonce for verification
4. THE Slots_Game SHALL ensure that the same seed combination and nonce always produces the same reel results
5. WHEN a Client_Seed is not provided, THE Slots_Game SHALL use a default Client_Seed value

### Requirement 11: Error Handling and Edge Cases

**User Story:** As a player, I want clear error messages when something goes wrong, so that I understand what happened and how to proceed.

#### Acceptance Criteria

1. WHEN a player submits an invalid bet amount (negative, zero, or non-numeric), THE Slots_Game SHALL reject the request with a descriptive error message
2. WHEN a player attempts to spin without sufficient balance, THE Slots_Game SHALL reject the request and display the current balance
3. WHEN a database error occurs during game creation, THE Slots_Game SHALL not deduct the bet amount from the player's balance
4. WHEN a payout fails to process, THE Slots_Game SHALL log the error and attempt to retry the transaction
5. WHEN an unauthenticated user attempts to access game endpoints, THE Slots_Game SHALL return an authentication error

### Requirement 12: Testing and Quality Assurance

**User Story:** As a developer, I want comprehensive automated tests for the slots game, so that we can ensure correctness and prevent regressions.

#### Acceptance Criteria

1. THE Slots_Game SHALL have unit tests covering all win combination detection logic
2. THE Slots_Game SHALL have unit tests covering payout calculation for all multiplier values
3. THE Slots_Game SHALL have API tests covering successful game creation and spin execution
4. THE Slots_Game SHALL have API tests covering error cases (insufficient balance, invalid bets, authentication failures)
5. THE Slots_Game SHALL have tests verifying Provably Fair integration produces consistent results
6. THE Slots_Game SHALL have tests verifying wallet balance updates occur correctly for wins and losses
