# Requirements Document

## Introduction

This specification defines the requirements for expanding the existing Django online casino platform with seven additional games. The platform currently has user authentication, wallet system, provably fair implementation, and two working games (Mines and Plinko). This expansion will add: Dice, Roulette, Slots, Crash, Wheel of Fortune, Blackjack, and Hi-Lo games, following the established architecture patterns.

## Glossary

- **Game_System**: The Django-based online casino platform
- **Player**: A registered user who plays casino games
- **Wallet_Service**: The existing service managing user balance and transactions
- **Provably_Fair_Service**: The existing service ensuring game fairness through cryptographic verification
- **Game_Service**: A service class implementing business logic for a specific game
- **Game_Model**: A Django model storing game state and history
- **Multiplier**: A numeric value that determines winnings (winnings = bet Ã— multiplier)
- **RTP**: Return to Player percentage (expected long-term payout)
- **Server_Seed**: A cryptographic seed generated by the server for provably fair games
- **Client_Seed**: A seed provided by the player for provably fair games
- **Nonce**: A sequential number used with seeds to generate unique game outcomes

## Requirements

### Requirement 1: Dice Game Implementation

**User Story:** As a player, I want to play a dice game where I guess the outcome, so that I can enjoy a simple, quick betting experience.

#### Acceptance Criteria

1. WHEN a player creates a dice game, THE Game_System SHALL accept bet amount and selected number (1-6)
2. WHEN a player places a bet, THE Wallet_Service SHALL deduct the bet amount from the player's balance
3. WHEN the dice is rolled, THE Game_System SHALL generate a random number from 1 to 6 using Provably_Fair_Service
4. IF the rolled number matches the selected number, THEN THE Game_System SHALL apply a 6x multiplier
5. IF the rolled number does not match, THEN THE Game_System SHALL apply a 0x multiplier
6. WHEN the game completes, THE Wallet_Service SHALL add winnings to the player's balance
7. THE Game_System SHALL store the game result with provably fair verification data

### Requirement 2: Roulette Game Implementation

**User Story:** As a player, I want to play European roulette with multiple bet types, so that I can experience a classic casino game.

#### Acceptance Criteria

1. WHEN a player creates a roulette game, THE Game_System SHALL accept bet amount and bet type (red, black, or green)
2. WHEN a player places a bet, THE Wallet_Service SHALL deduct the bet amount from the player's balance
3. WHEN the wheel spins, THE Game_System SHALL generate a random number from 0 to 36 using Provably_Fair_Service
4. WHEN the result is 0, THE Game_System SHALL classify it as green
5. WHEN the result is 1-36, THE Game_System SHALL classify it as red or black according to standard European roulette color mapping
6. IF the player bet on red and the result is red, THEN THE Game_System SHALL apply a 2x multiplier
7. IF the player bet on black and the result is black, THEN THE Game_System SHALL apply a 2x multiplier
8. IF the player bet on green and the result is 0, THEN THE Game_System SHALL apply a 14x multiplier
9. IF the bet does not match the result, THEN THE Game_System SHALL apply a 0x multiplier
10. WHEN the game completes, THE Wallet_Service SHALL add winnings to the player's balance
11. THE Game_System SHALL provide wheel visualization data including ball position

### Requirement 3: Slots Game Implementation

**User Story:** As a player, I want to play a slot machine with multiple reels and winning combinations, so that I can enjoy a visual and engaging game.

#### Acceptance Criteria

1. WHEN a player creates a slots game, THE Game_System SHALL accept bet amount
2. WHEN a player places a bet, THE Wallet_Service SHALL deduct the bet amount from the player's balance
3. WHEN the reels spin, THE Game_System SHALL generate 5 random symbols using Provably_Fair_Service
4. THE Game_System SHALL define at least 5 different symbol types with varying rarities
5. WHEN the reels stop, THE Game_System SHALL evaluate winning combinations based on symbol matches
6. IF 3 matching symbols appear, THEN THE Game_System SHALL apply a multiplier based on symbol rarity
7. IF 4 matching symbols appear, THEN THE Game_System SHALL apply a higher multiplier
8. IF 5 matching symbols appear, THEN THE Game_System SHALL apply the highest multiplier
9. WHEN the game completes, THE Wallet_Service SHALL add winnings to the player's balance
10. THE Game_System SHALL provide spinning animation data for frontend visualization

### Requirement 4: Crash Game Implementation

**User Story:** As a player, I want to play a crash game where I cash out before the multiplier crashes, so that I can experience high-risk, high-reward gameplay.

#### Acceptance Criteria

1. WHEN a player creates a crash game, THE Game_System SHALL accept bet amount
2. WHEN a player places a bet, THE Wallet_Service SHALL deduct the bet amount from the player's balance
3. WHEN the game starts, THE Game_System SHALL generate a crash point using Provably_Fair_Service
4. THE Game_System SHALL simulate a growing multiplier from 1.00x upward
5. WHEN a player requests cashout, THE Game_System SHALL record the current multiplier
6. IF the player cashes out before the crash point, THEN THE Game_System SHALL apply the cashout multiplier
7. IF the player does not cash out before the crash point, THEN THE Game_System SHALL apply a 0x multiplier
8. WHEN the game completes, THE Wallet_Service SHALL add winnings to the player's balance
9. THE Game_System SHALL provide multiplier growth data for graph visualization

### Requirement 5: Wheel of Fortune Game Implementation

**User Story:** As a player, I want to spin a wheel of fortune with different prize sectors, so that I can win various multipliers.

#### Acceptance Criteria

1. WHEN a player creates a wheel game, THE Game_System SHALL accept bet amount
2. WHEN a player places a bet, THE Wallet_Service SHALL deduct the bet amount from the player's balance
3. WHEN the wheel spins, THE Game_System SHALL generate a random sector using Provably_Fair_Service
4. THE Game_System SHALL define at least 8 sectors with different multipliers
5. THE Game_System SHALL ensure sector probabilities result in approximately 95-97% RTP
6. WHEN the wheel stops, THE Game_System SHALL apply the multiplier of the selected sector
7. WHEN the game completes, THE Wallet_Service SHALL add winnings to the player's balance
8. THE Game_System SHALL provide wheel rotation data for spin animation

### Requirement 6: Blackjack Game Implementation

**User Story:** As a player, I want to play blackjack against a dealer, so that I can enjoy a strategic card game.

#### Acceptance Criteria

1. WHEN a player creates a blackjack game, THE Game_System SHALL accept bet amount
2. WHEN a player places a bet, THE Wallet_Service SHALL deduct the bet amount from the player's balance
3. WHEN the game starts, THE Game_System SHALL deal 2 cards to the player and 2 cards to the dealer using Provably_Fair_Service
4. THE Game_System SHALL calculate hand values where Ace = 1 or 11, face cards = 10, number cards = face value
5. WHEN a player requests hit, THE Game_System SHALL deal one additional card to the player
6. WHEN a player requests stand, THE Game_System SHALL complete the dealer's hand according to standard rules
7. THE Game_System SHALL require the dealer to hit on 16 or less and stand on 17 or more
8. IF the player's hand exceeds 21, THEN THE Game_System SHALL apply a 0x multiplier
9. IF the dealer's hand exceeds 21 and the player's does not, THEN THE Game_System SHALL apply a 2x multiplier
10. IF the player's hand value exceeds the dealer's without busting, THEN THE Game_System SHALL apply a 2x multiplier
11. IF the player's hand equals the dealer's hand, THEN THE Game_System SHALL apply a 1x multiplier (push)
12. IF the player gets blackjack (21 with 2 cards), THEN THE Game_System SHALL apply a 2.5x multiplier
13. WHEN the game completes, THE Wallet_Service SHALL add winnings to the player's balance

### Requirement 7: Hi-Lo Game Implementation

**User Story:** As a player, I want to guess if the next card is higher or lower, so that I can build consecutive wins with growing multipliers.

#### Acceptance Criteria

1. WHEN a player creates a hi-lo game, THE Game_System SHALL accept bet amount
2. WHEN a player places a bet, THE Wallet_Service SHALL deduct the bet amount from the player's balance
3. WHEN the game starts, THE Game_System SHALL reveal an initial card using Provably_Fair_Service
4. WHEN a player guesses higher or lower, THE Game_System SHALL reveal the next card
5. IF the guess is correct, THEN THE Game_System SHALL increase the multiplier and allow continuation
6. IF the guess is incorrect, THEN THE Game_System SHALL end the game with a 0x multiplier
7. THE Game_System SHALL increase the multiplier by a fixed percentage for each correct guess
8. WHEN a player cashes out, THE Game_System SHALL apply the current multiplier
9. WHEN the game completes, THE Wallet_Service SHALL add winnings to the player's balance
10. THE Game_System SHALL maintain a history of revealed cards for the current game

### Requirement 8: Game Model Architecture

**User Story:** As a developer, I want consistent game model structure, so that all games follow the same architectural patterns.

#### Acceptance Criteria

1. THE Game_System SHALL create a Django model for each game type
2. WHEN a game model is created, THE Game_System SHALL include user foreign key, bet amount, and timestamps
3. WHERE provably fair verification is required, THE Game_System SHALL include server_seed, client_seed, nonce, and server_seed_hash fields
4. THE Game_System SHALL store game-specific state in appropriate fields or JSON fields
5. THE Game_System SHALL include indexes on user and created_at fields for query performance

### Requirement 9: Game Service Architecture

**User Story:** As a developer, I want consistent game service structure, so that all games follow the same business logic patterns.

#### Acceptance Criteria

1. THE Game_System SHALL create a service class for each game type
2. WHEN a service is created, THE Game_System SHALL implement validation methods for bet amount and game parameters
3. THE Game_System SHALL implement a create_game method that validates parameters and creates the game instance
4. THE Game_System SHALL implement game-specific action methods (e.g., roll, spin, hit, cashout)
5. THE Game_System SHALL use database transactions for all state-changing operations
6. THE Game_System SHALL integrate with Wallet_Service for all balance operations
7. WHERE applicable, THE Game_System SHALL integrate with Provably_Fair_Service for random number generation

### Requirement 10: API Endpoint Architecture

**User Story:** As a frontend developer, I want consistent REST API endpoints, so that I can integrate games uniformly.

#### Acceptance Criteria

1. THE Game_System SHALL create API endpoints for each game following the pattern /api/games/{game_name}/
2. WHEN an endpoint is created, THE Game_System SHALL implement POST /create/ for game creation
3. THE Game_System SHALL implement POST /action/ for game-specific actions
4. THE Game_System SHALL implement GET /history/ for retrieving player's game history
5. THE Game_System SHALL implement GET /{game_id}/ for retrieving specific game details
6. THE Game_System SHALL return consistent JSON response format with success, data, and error fields
7. THE Game_System SHALL require authentication for all game endpoints
8. THE Game_System SHALL validate request data and return appropriate error messages

### Requirement 11: Frontend Template Architecture

**User Story:** As a player, I want consistent game interfaces, so that all games have a familiar look and feel.

#### Acceptance Criteria

1. THE Game_System SHALL create an HTML template for each game
2. WHEN a template is created, THE Game_System SHALL extend the base template
3. THE Game_System SHALL use consistent styling from the landing page
4. THE Game_System SHALL include game-specific controls and visualization areas
5. THE Game_System SHALL display current balance and bet amount
6. THE Game_System SHALL provide visual feedback for game actions
7. THE Game_System SHALL display game results and winnings clearly

### Requirement 12: Navigation Integration

**User Story:** As a player, I want to access all games from the navigation menu, so that I can easily switch between games.

#### Acceptance Criteria

1. WHEN a new game is implemented, THE Game_System SHALL add it to the main navigation menu
2. THE Game_System SHALL display game names with appropriate icons
3. THE Game_System SHALL highlight the currently active game in the navigation
4. THE Game_System SHALL organize games in a logical order

### Requirement 13: Home Page Integration

**User Story:** As a player, I want to see all available games on the home page, so that I can choose which game to play.

#### Acceptance Criteria

1. WHEN a new game is implemented, THE Game_System SHALL add it to the home page game grid
2. THE Game_System SHALL display game cards with name, icon, and brief description
3. THE Game_System SHALL make game cards clickable to navigate to the game page
4. THE Game_System SHALL display games in priority order

### Requirement 14: Provably Fair Implementation

**User Story:** As a player, I want all games to be provably fair, so that I can verify game outcomes are not manipulated.

#### Acceptance Criteria

1. THE Game_System SHALL use Provably_Fair_Service for all random number generation
2. WHEN a game is created, THE Game_System SHALL generate server_seed and client_seed
3. THE Game_System SHALL hash the server_seed and provide it to the player before the game
4. WHEN a game completes, THE Game_System SHALL reveal the server_seed for verification
5. THE Game_System SHALL provide a verification endpoint that accepts seeds and nonce
6. THE Game_System SHALL allow players to provide custom client_seed before game creation

### Requirement 15: Testing Requirements

**User Story:** As a developer, I want comprehensive tests for all games, so that I can ensure correctness and prevent regressions.

#### Acceptance Criteria

1. THE Game_System SHALL include unit tests for each game service
2. THE Game_System SHALL include API integration tests for each game
3. THE Game_System SHALL test bet validation and balance checks
4. THE Game_System SHALL test game logic and multiplier calculations
5. THE Game_System SHALL test provably fair verification
6. THE Game_System SHALL test error handling and edge cases
7. THE Game_System SHALL achieve at least 80% code coverage for game modules
